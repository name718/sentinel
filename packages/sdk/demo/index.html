<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monitor SDK - å‰ç«¯ç›‘æ§æ¼”ç¤ºå¹³å°</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --bg: #f8fafc;
      --card-bg: #ffffff;
      --text: #1e293b;
      --text-secondary: #64748b;
      --border: #e2e8f0;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
    }
</style>
</head>
<body>
  <nav class="navbar">
    <div class="nav-content">
      <div class="logo">
        <span class="logo-icon">ğŸ“Š</span>
        <span class="logo-text">Monitor SDK</span>
        <span class="version">v1.0.0</span>
      </div>
      <div class="nav-status">
        <span class="status-dot" id="statusDot"></span>
        <span id="statusText">æœªåˆå§‹åŒ–</span>
      </div>
    </div>
  </nav>
</body>
</html>

<style>
    .navbar {
      background: var(--card-bg);
      border-bottom: 1px solid var(--border);
      padding: 16px 24px;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .nav-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .logo-icon { font-size: 24px; }
    .logo-text { font-size: 20px; font-weight: 600; }
    .version {
      background: var(--primary);
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
    }
    .nav-status {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: var(--bg);
      border-radius: 20px;
    }
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--text-secondary);
    }
    .status-dot.active { background: var(--success); }
    .status-dot.error { background: var(--danger); }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 24px;
    }
    .hero {
      text-align: center;
      padding: 48px 24px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      border-radius: 16px;
      margin-bottom: 24px;
    }
    .hero h1 { font-size: 32px; margin-bottom: 12px; }
    .hero p { opacity: 0.9; font-size: 16px; }
</style>

<style>
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 24px;
      margin-bottom: 24px;
    }
    .card {
      background: var(--card-bg);
      border-radius: 12px;
      border: 1px solid var(--border);
      overflow: hidden;
    }
    .card-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .card-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }
    .card-icon.error { background: #fef2f2; }
    .card-icon.behavior { background: #f0fdf4; }
    .card-icon.perf { background: #eff6ff; }
    .card-icon.data { background: #fefce8; }
    .card-title { font-weight: 600; font-size: 16px; }
    .card-body { padding: 20px; }

    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .btn {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .btn:hover { transform: translateY(-1px); }
    .btn:active { transform: translateY(0); }
    .btn-primary {
      background: var(--primary);
      color: white;
    }
    .btn-primary:hover { background: var(--primary-dark); }
    .btn-danger {
      background: var(--danger);
      color: white;
    }
    .btn-warning {
      background: var(--warning);
      color: white;
    }
    .btn-success {
      background: var(--success);
      color: white;
    }
    .btn-outline {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text);
    }
    .btn-outline:hover { background: var(--bg); }
</style>

<style>
    .console {
      background: #1e293b;
      border-radius: 8px;
      padding: 16px;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 13px;
      color: #e2e8f0;
      max-height: 300px;
      overflow-y: auto;
    }
    .console-line {
      padding: 4px 0;
      border-bottom: 1px solid #334155;
    }
    .console-line:last-child { border-bottom: none; }
    .console-time {
      color: #64748b;
      margin-right: 8px;
    }
    .console-info { color: #60a5fa; }
    .console-success { color: #4ade80; }
    .console-error { color: #f87171; }
    .console-warn { color: #fbbf24; }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }
    .stat-item {
      text-align: center;
      padding: 16px;
      background: var(--bg);
      border-radius: 8px;
    }
    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary);
    }
    .stat-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    .breadcrumb-list {
      max-height: 200px;
      overflow-y: auto;
    }
    .breadcrumb-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      background: var(--bg);
      border-radius: 6px;
      margin-bottom: 8px;
      font-size: 13px;
    }
    .breadcrumb-type {
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
    }
    .breadcrumb-type.click { background: #dbeafe; color: #1d4ed8; }
    .breadcrumb-type.fetch { background: #dcfce7; color: #166534; }
    .breadcrumb-type.console { background: #fef3c7; color: #92400e; }
    .breadcrumb-type.route { background: #f3e8ff; color: #7c3aed; }
    .breadcrumb-type.xhr { background: #ffe4e6; color: #be123c; }
    .breadcrumb-msg { flex: 1; color: var(--text-secondary); }
    .breadcrumb-time { color: var(--text-secondary); font-size: 11px; }

    .init-form {
      display: grid;
      gap: 16px;
    }
    .form-group label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 6px;
      color: var(--text-secondary);
    }
    .form-group input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 14px;
    }
    .form-group input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }
</style>

<style>
    .perf-metrics {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }
    .perf-item {
      padding: 12px;
      background: var(--bg);
      border-radius: 8px;
    }
    .perf-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }
    .perf-value {
      font-size: 20px;
      font-weight: 600;
    }
    .perf-value.good { color: var(--success); }
    .perf-value.warning { color: var(--warning); }
    .perf-value.bad { color: var(--danger); }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    .data-table th, .data-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    .data-table th {
      background: var(--bg);
      font-weight: 600;
      color: var(--text-secondary);
    }
    .data-table tr:hover { background: var(--bg); }
    .error-type {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
    }
    .error-type.error { background: #fef2f2; color: #dc2626; }
    .error-type.unhandledrejection { background: #fef3c7; color: #d97706; }
    .error-type.resource { background: #dbeafe; color: #2563eb; }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: var(--text-secondary);
    }
    .empty-state-icon { font-size: 48px; margin-bottom: 12px; }

    @media (max-width: 768px) {
      .grid { grid-template-columns: 1fr; }
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      .perf-metrics { grid-template-columns: 1fr; }
    }
</style>

  <div class="container">
    <div class="hero">
      <h1>ğŸš€ å‰ç«¯ç›‘æ§ SDK æ¼”ç¤ºå¹³å°</h1>
      <p>å®æ—¶æ•è·é”™è¯¯ã€è¿½è¸ªç”¨æˆ·è¡Œä¸ºã€ç›‘æ§é¡µé¢æ€§èƒ½</p>
    </div>

    <div class="grid">
      <!-- åˆå§‹åŒ–é…ç½® -->
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background: #f0f9ff;">âš™ï¸</div>
          <span class="card-title">SDK åˆå§‹åŒ–</span>
        </div>
        <div class="card-body">
          <div class="init-form">
            <div class="form-group">
              <label>é¡¹ç›®æ ‡è¯† (DSN)</label>
              <input type="text" id="dsnInput" value="demo-project" placeholder="è¾“å…¥é¡¹ç›®æ ‡è¯†">
            </div>
            <div class="form-group">
              <label>ä¸ŠæŠ¥åœ°å€</label>
              <input type="text" id="reportUrlInput" value="http://localhost:3000/api/report" placeholder="è¾“å…¥ä¸ŠæŠ¥åœ°å€">
            </div>
            <div class="btn-group">
              <button class="btn btn-primary" onclick="initSDK()">ğŸ”Œ åˆå§‹åŒ– SDK</button>
              <button class="btn btn-outline" onclick="destroySDK()">ğŸ”„ é‡ç½®</button>
            </div>
          </div>
        </div>
      </div>

      <!-- é”™è¯¯æ¨¡æ‹Ÿ -->
      <div class="card">
        <div class="card-header">
          <div class="card-icon error">ğŸ›</div>
          <span class="card-title">é”™è¯¯æ•è·æµ‹è¯•</span>
        </div>
        <div class="card-body">
          <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 16px;">
            æ¨¡æ‹Ÿå„ç±»å‰ç«¯é”™è¯¯ï¼ŒéªŒè¯ SDK çš„é”™è¯¯æ•è·èƒ½åŠ›
          </p>
          <div class="btn-group">
            <button class="btn btn-danger" onclick="triggerJSError()">ğŸ’¥ JS é”™è¯¯</button>
            <button class="btn btn-warning" onclick="triggerPromiseError()">âš¡ Promise é”™è¯¯</button>
            <button class="btn btn-outline" onclick="triggerResourceError()">ğŸ–¼ï¸ èµ„æºåŠ è½½å¤±è´¥</button>
            <button class="btn btn-outline" onclick="manualCapture()">âœ‹ æ‰‹åŠ¨æ•è·</button>
          </div>
        </div>
      </div>
    </div>

    <div class="grid">
      <!-- ç”¨æˆ·è¡Œä¸º -->
      <div class="card">
        <div class="card-header">
          <div class="card-icon behavior">ğŸ‘†</div>
          <span class="card-title">ç”¨æˆ·è¡Œä¸ºè¿½è¸ª</span>
        </div>
        <div class="card-body">
          <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 16px;">
            è‡ªåŠ¨è®°å½•ç”¨æˆ·æ“ä½œï¼Œé”™è¯¯å‘ç”Ÿæ—¶å¯è¿˜åŸè¡Œä¸ºè½¨è¿¹
          </p>
          <div class="btn-group" style="margin-bottom: 16px;">
            <button class="btn btn-success" onclick="testFetch()">ğŸŒ å‘èµ·è¯·æ±‚</button>
            <button class="btn btn-outline" onclick="testConsole()">ğŸ“ Console æ—¥å¿—</button>
            <button class="btn btn-outline" onclick="testRoute()">ğŸ”— æ¨¡æ‹Ÿè·¯ç”±</button>
          </div>
          <div class="breadcrumb-list" id="breadcrumbList">
            <div class="empty-state">
              <div class="empty-state-icon">ğŸ“­</div>
              <p>æš‚æ— è¡Œä¸ºè®°å½•</p>
            </div>
          </div>
        </div>
      </div>

      <!-- æ€§èƒ½æŒ‡æ ‡ -->
      <div class="card">
        <div class="card-header">
          <div class="card-icon perf">âš¡</div>
          <span class="card-title">æ€§èƒ½æŒ‡æ ‡</span>
        </div>
        <div class="card-body">
          <div class="perf-metrics" id="perfMetrics">
            <div class="perf-item">
              <div class="perf-label">FCP (é¦–æ¬¡å†…å®¹ç»˜åˆ¶)</div>
              <div class="perf-value" id="perfFcp">--</div>
            </div>
            <div class="perf-item">
              <div class="perf-label">LCP (æœ€å¤§å†…å®¹ç»˜åˆ¶)</div>
              <div class="perf-value" id="perfLcp">--</div>
            </div>
            <div class="perf-item">
              <div class="perf-label">TTFB (é¦–å­—èŠ‚æ—¶é—´)</div>
              <div class="perf-value" id="perfTtfb">--</div>
            </div>
            <div class="perf-item">
              <div class="perf-label">DOM Ready</div>
              <div class="perf-value" id="perfDomReady">--</div>
            </div>
          </div>
          <div style="margin-top: 16px;">
            <button class="btn btn-outline" onclick="refreshPerf()">ğŸ”„ åˆ·æ–°æŒ‡æ ‡</button>
          </div>
        </div>
      </div>
    </div>

    <!-- æ•°æ®ç»Ÿè®¡ -->
    <div class="card" style="margin-bottom: 24px;">
      <div class="card-header">
        <div class="card-icon data">ğŸ“ˆ</div>
        <span class="card-title">æ•°æ®ç»Ÿè®¡</span>
        <div style="margin-left: auto;">
          <button class="btn btn-primary" onclick="flushData()">ğŸ“¤ ç«‹å³ä¸ŠæŠ¥</button>
          <button class="btn btn-outline" onclick="refreshStats()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
        </div>
      </div>
      <div class="card-body">
        <div class="stats-grid" style="margin-bottom: 24px;">
          <div class="stat-item">
            <div class="stat-value" id="statErrors">0</div>
            <div class="stat-label">é”™è¯¯æ€»æ•°</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="statPerf">0</div>
            <div class="stat-label">æ€§èƒ½è®°å½•</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="statQueue">0</div>
            <div class="stat-label">å¾…ä¸ŠæŠ¥é˜Ÿåˆ—</div>
          </div>
        </div>
        
        <h4 style="margin-bottom: 12px; font-size: 14px; color: var(--text-secondary);">æœ€è¿‘é”™è¯¯</h4>
        <div style="overflow-x: auto;">
          <table class="data-table" id="errorTable">
            <thead>
              <tr>
                <th>ç±»å‹</th>
                <th>é”™è¯¯ä¿¡æ¯</th>
                <th>æ¬¡æ•°</th>
                <th>æ—¶é—´</th>
              </tr>
            </thead>
            <tbody id="errorTableBody">
              <tr>
                <td colspan="4" class="empty-state">
                  <div class="empty-state-icon">âœ¨</div>
                  <p>æš‚æ— é”™è¯¯è®°å½•</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- æ§åˆ¶å° -->
    <div class="card">
      <div class="card-header">
        <div class="card-icon" style="background: #1e293b;">ğŸ’»</div>
        <span class="card-title">å®æ—¶æ—¥å¿—</span>
        <button class="btn btn-outline" style="margin-left: auto;" onclick="clearConsole()">æ¸…ç©º</button>
      </div>
      <div class="card-body">
        <div class="console" id="console">
          <div class="console-line">
            <span class="console-time">[--:--:--]</span>
            <span class="console-info">ç­‰å¾… SDK åˆå§‹åŒ–...</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="../dist/index.js"></script>
  <script>
    // æ—¥å¿—è¾“å‡º
    const consoleEl = document.getElementById('console');
    function log(msg, type = 'info') {
      const time = new Date().toLocaleTimeString();
      const line = document.createElement('div');
      line.className = 'console-line';
      line.innerHTML = `<span class="console-time">[${time}]</span><span class="console-${type}">${msg}</span>`;
      consoleEl.appendChild(line);
      consoleEl.scrollTop = consoleEl.scrollHeight;
    }
    function clearConsole() {
      consoleEl.innerHTML = '';
      log('æ§åˆ¶å°å·²æ¸…ç©º', 'info');
    }

    // çŠ¶æ€æ›´æ–°
    function updateStatus(active, text) {
      const dot = document.getElementById('statusDot');
      const statusText = document.getElementById('statusText');
      dot.className = 'status-dot' + (active ? ' active' : '');
      statusText.textContent = text;
    }

    // SDK åˆå§‹åŒ–
    function initSDK() {
      const dsn = document.getElementById('dsnInput').value;
      const reportUrl = document.getElementById('reportUrlInput').value;
      
      if (!dsn || !reportUrl) {
        log('è¯·å¡«å†™å®Œæ•´é…ç½®', 'error');
        return;
      }

      try {
        Monitor.Monitor.getInstance().init({
          dsn,
          reportUrl,
          maxBreadcrumbs: 20,
          batchSize: 5,
          reportInterval: 10000
        });
        updateStatus(true, 'å·²è¿æ¥');
        log('âœ… SDK åˆå§‹åŒ–æˆåŠŸ', 'success');
        log(`   DSN: ${dsn}`, 'info');
        log(`   ä¸ŠæŠ¥åœ°å€: ${reportUrl}`, 'info');
        refreshBreadcrumbs();
        refreshStats();
      } catch (e) {
        updateStatus(false, 'åˆå§‹åŒ–å¤±è´¥');
        log('âŒ åˆå§‹åŒ–å¤±è´¥: ' + e.message, 'error');
      }
    }

    function destroySDK() {
      Monitor.Monitor.getInstance().destroy();
      updateStatus(false, 'æœªåˆå§‹åŒ–');
      log('ğŸ”„ SDK å·²é‡ç½®', 'warn');
      document.getElementById('breadcrumbList').innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“­</div><p>æš‚æ— è¡Œä¸ºè®°å½•</p></div>';
    }
  </script>

  <script>
    // é”™è¯¯æµ‹è¯•
    function triggerJSError() {
      log('ğŸ› è§¦å‘ JS è¿è¡Œæ—¶é”™è¯¯...', 'warn');
      setTimeout(() => { undefinedFunction(); }, 100);
    }

    function triggerPromiseError() {
      log('âš¡ è§¦å‘ Promise é”™è¯¯...', 'warn');
      Promise.reject(new Error('æµ‹è¯• Promise Rejection'));
    }

    function triggerResourceError() {
      log('ğŸ–¼ï¸ åŠ è½½ä¸å­˜åœ¨çš„èµ„æº...', 'warn');
      const img = document.createElement('img');
      img.src = 'http://localhost:9999/not-exist-' + Date.now() + '.png';
      img.style.display = 'none';
      document.body.appendChild(img);
    }

    function manualCapture() {
      const monitor = Monitor.Monitor.getInstance();
      if (!monitor.isInitialized()) {
        log('è¯·å…ˆåˆå§‹åŒ– SDK', 'error');
        return;
      }
      monitor.captureError(new Error('æ‰‹åŠ¨æ•è·çš„æµ‹è¯•é”™è¯¯'));
      log('âœ‹ å·²æ‰‹åŠ¨æ•è·é”™è¯¯', 'success');
    }

    // è¡Œä¸ºæµ‹è¯•
    async function testFetch() {
      log('ğŸŒ å‘èµ· Fetch è¯·æ±‚...', 'info');
      try {
        const res = await fetch('http://localhost:3000/api/health');
        const data = await res.json();
        log('âœ… è¯·æ±‚æˆåŠŸ: ' + JSON.stringify(data), 'success');
      } catch (e) {
        log('âŒ è¯·æ±‚å¤±è´¥: ' + e.message, 'error');
      }
      setTimeout(refreshBreadcrumbs, 100);
    }

    function testConsole() {
      console.log('è¿™æ˜¯ä¸€æ¡ console.log æ—¥å¿—');
      console.warn('è¿™æ˜¯ä¸€æ¡ console.warn è­¦å‘Š');
      console.error('è¿™æ˜¯ä¸€æ¡ console.error é”™è¯¯');
      log('ğŸ“ å·²è¾“å‡º console æ—¥å¿— (log/warn/error)', 'info');
      setTimeout(refreshBreadcrumbs, 100);
    }

    function testRoute() {
      const path = '/page-' + Math.random().toString(36).substr(2, 6);
      history.pushState({}, '', path);
      log('ğŸ”— è·¯ç”±å˜åŒ–: ' + path, 'info');
      setTimeout(refreshBreadcrumbs, 100);
    }
  </script>

  <script>
    // Breadcrumbs åˆ·æ–°
    function refreshBreadcrumbs() {
      const monitor = Monitor.Monitor.getInstance();
      if (!monitor.isInitialized()) return;
      
      const breadcrumbs = monitor.getBreadcrumbs();
      const container = document.getElementById('breadcrumbList');
      
      if (breadcrumbs.length === 0) {
        container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“­</div><p>æš‚æ— è¡Œä¸ºè®°å½•</p></div>';
        return;
      }

      container.innerHTML = breadcrumbs.slice(-10).reverse().map(b => {
        const time = new Date(b.timestamp).toLocaleTimeString();
        return `
          <div class="breadcrumb-item">
            <span class="breadcrumb-type ${b.type}">${b.type}</span>
            <span class="breadcrumb-msg">${b.message.substring(0, 50)}${b.message.length > 50 ? '...' : ''}</span>
            <span class="breadcrumb-time">${time}</span>
          </div>
        `;
      }).join('');
    }

    // æ€§èƒ½æŒ‡æ ‡
    function refreshPerf() {
      const paintEntries = performance.getEntriesByType('paint');
      const navEntries = performance.getEntriesByType('navigation');
      
      paintEntries.forEach(entry => {
        if (entry.name === 'first-contentful-paint') {
          updatePerfValue('perfFcp', entry.startTime);
        }
      });

      if (navEntries.length > 0) {
        const nav = navEntries[0];
        updatePerfValue('perfTtfb', nav.responseStart - nav.requestStart);
        updatePerfValue('perfDomReady', nav.domContentLoadedEventEnd - nav.fetchStart);
      }

      // LCP éœ€è¦ PerformanceObserver
      try {
        new PerformanceObserver((list) => {
          const entries = list.getEntries();
          if (entries.length > 0) {
            updatePerfValue('perfLcp', entries[entries.length - 1].startTime);
          }
        }).observe({ type: 'largest-contentful-paint', buffered: true });
      } catch (e) {}

      log('ğŸ”„ æ€§èƒ½æŒ‡æ ‡å·²åˆ·æ–°', 'info');
    }

    function updatePerfValue(id, value) {
      const el = document.getElementById(id);
      const ms = Math.round(value);
      el.textContent = ms + 'ms';
      el.className = 'perf-value ' + (ms < 1000 ? 'good' : ms < 2500 ? 'warning' : 'bad');
    }
  </script>

  <script>
    // æ•°æ®ç»Ÿè®¡
    function flushData() {
      const monitor = Monitor.Monitor.getInstance();
      if (!monitor.isInitialized()) {
        log('è¯·å…ˆåˆå§‹åŒ– SDK', 'error');
        return;
      }
      monitor.flush();
      log('ğŸ“¤ å·²è§¦å‘æ•°æ®ä¸ŠæŠ¥', 'success');
      setTimeout(refreshStats, 500);
    }

    async function refreshStats() {
      const monitor = Monitor.Monitor.getInstance();
      const dsn = document.getElementById('dsnInput').value;
      
      // é˜Ÿåˆ—é•¿åº¦
      const reporter = monitor.getReporter();
      document.getElementById('statQueue').textContent = reporter ? reporter.getQueueLength() : 0;

      // ä»æœåŠ¡ç«¯è·å–ç»Ÿè®¡
      try {
        const errRes = await fetch(`http://localhost:3000/api/errors?dsn=${dsn}&pageSize=5`);
        const errData = await errRes.json();
        document.getElementById('statErrors').textContent = errData.total || 0;
        renderErrorTable(errData.list || []);

        const perfRes = await fetch(`http://localhost:3000/api/performance?dsn=${dsn}`);
        const perfData = await perfRes.json();
        document.getElementById('statPerf').textContent = perfData.count || 0;
      } catch (e) {
        log('è·å–ç»Ÿè®¡æ•°æ®å¤±è´¥: ' + e.message, 'error');
      }
    }

    function renderErrorTable(errors) {
      const tbody = document.getElementById('errorTableBody');
      if (errors.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="empty-state"><div class="empty-state-icon">âœ¨</div><p>æš‚æ— é”™è¯¯è®°å½•</p></td></tr>';
        return;
      }
      tbody.innerHTML = errors.map(err => {
        const time = new Date(err.timestamp).toLocaleString();
        const msg = err.message.length > 40 ? err.message.substring(0, 40) + '...' : err.message;
        return `
          <tr>
            <td><span class="error-type ${err.type}">${err.type}</span></td>
            <td title="${err.message}">${msg}</td>
            <td>${err.count}</td>
            <td>${time}</td>
          </tr>
        `;
      }).join('');
    }

    // å…¨å±€é”™è¯¯ç›‘å¬ï¼ˆç”¨äº UI åé¦ˆï¼‰
    window.addEventListener('error', (e) => {
      log('âŒ æ•è·é”™è¯¯: ' + e.message, 'error');
      setTimeout(refreshStats, 500);
    });
    window.addEventListener('unhandledrejection', (e) => {
      log('âŒ Promise é”™è¯¯: ' + e.reason, 'error');
      setTimeout(refreshStats, 500);
    });

    // é¡µé¢åŠ è½½å®Œæˆååˆ·æ–°æ€§èƒ½æŒ‡æ ‡
    window.addEventListener('load', () => {
      setTimeout(refreshPerf, 1000);
    });
  </script>
</body>
</html>